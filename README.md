* [《C和指针》简介](#c%E5%92%8C%E6%8C%87%E9%92%88%E7%AE%80%E4%BB%8B)
* [丛书信息](#%E4%B8%9B%E4%B9%A6%E4%BF%A1%E6%81%AF)
* [警告与提示](#%E8%AD%A6%E5%91%8A%E4%B8%8E%E6%8F%90%E7%A4%BA)
  * [快速上手](#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B)
    * [警告](#%E8%AD%A6%E5%91%8A)
    * [提示](#%E6%8F%90%E7%A4%BA)
  * [基本概念](#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5)
    * [警告](#%E8%AD%A6%E5%91%8A-1)
    * [提示](#%E6%8F%90%E7%A4%BA-1)
  * [数据](#%E6%95%B0%E6%8D%AE)
    * [警告](#%E8%AD%A6%E5%91%8A-2)
    * [提示](#%E6%8F%90%E7%A4%BA-2)
  * [语句](#%E8%AF%AD%E5%8F%A5)
    * [警告](#%E8%AD%A6%E5%91%8A-3)
    * [提示](#%E6%8F%90%E7%A4%BA-3)
  * [操作符和表达式](#%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%92%8C%E8%A1%A8%E8%BE%BE%E5%BC%8F)
    * [警告](#%E8%AD%A6%E5%91%8A-4)
    * [提示](#%E6%8F%90%E7%A4%BA-4)
  * [指针](#%E6%8C%87%E9%92%88)
    * [警告](#%E8%AD%A6%E5%91%8A-5)
    * [提示](#%E6%8F%90%E7%A4%BA-5)
  * [函数](#%E5%87%BD%E6%95%B0)
    * [警告](#%E8%AD%A6%E5%91%8A-6)
    * [提示](#%E6%8F%90%E7%A4%BA-6)
  * [数组](#%E6%95%B0%E7%BB%84)
    * [警告](#%E8%AD%A6%E5%91%8A-7)
    * [提示](#%E6%8F%90%E7%A4%BA-7)
  * [字符串、字符和字节](#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E7%AC%A6%E5%92%8C%E5%AD%97%E8%8A%82)
    * [警告](#%E8%AD%A6%E5%91%8A-8)
    * [提示](#%E6%8F%90%E7%A4%BA-8)
  * [结构和联合](#%E7%BB%93%E6%9E%84%E5%92%8C%E8%81%94%E5%90%88)
    * [警告](#%E8%AD%A6%E5%91%8A-9)
    * [提示](#%E6%8F%90%E7%A4%BA-9)
  * [动态内存分配](#%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D)
    * [警告](#%E8%AD%A6%E5%91%8A-10)
    * [提示](#%E6%8F%90%E7%A4%BA-10)
  * [使用结构和指针](#%E4%BD%BF%E7%94%A8%E7%BB%93%E6%9E%84%E5%92%8C%E6%8C%87%E9%92%88)
    * [警告](#%E8%AD%A6%E5%91%8A-11)
    * [提示](#%E6%8F%90%E7%A4%BA-11)
  * [高级指针话题](#%E9%AB%98%E7%BA%A7%E6%8C%87%E9%92%88%E8%AF%9D%E9%A2%98)
    * [警告](#%E8%AD%A6%E5%91%8A-12)
    * [提示](#%E6%8F%90%E7%A4%BA-12)
    * [警告](#%E8%AD%A6%E5%91%8A-13)
    * [提示](#%E6%8F%90%E7%A4%BA-13)
  * [输入输出函数](#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E5%87%BD%E6%95%B0)
    * [警告](#%E8%AD%A6%E5%91%8A-14)
    * [提示](#%E6%8F%90%E7%A4%BA-14)
  * [标准函数库](#%E6%A0%87%E5%87%86%E5%87%BD%E6%95%B0%E5%BA%93)
    * [警告](#%E8%AD%A6%E5%91%8A-15)
    * [提示](#%E6%8F%90%E7%A4%BA-15)

# 《C和指针》简介

本书提供与C语言编程相关的全面资源和深入讨论。本书通过对指针的基础知识和高级特性的探讨，帮助程序员把指针的强大功能融入到自己的程序中去。

全书共18章，覆盖了数据、语句、操作符和表达式、指针、函数、数组、字符串、结构和联合等几乎所有重要的C编程话题。书中给出了很多编程技巧和提示，每章后面有针对性很强的练习，附录部分则给出了部分练习的解答。

本书适合C语言初学者和初级C程序员阅读，也可作为计算机专业学生学习C语言的参考。

# 丛书信息

C和C++经典著作 (共5册), 这套丛书还有 《C专家编程》,《C陷阱与缺陷》,《C++沉思录》,《C++Templates中文版》

# 警告与提示

## 快速上手

### 警告

- 在 scanf 函数的标量参数前未添加 & 字符
- 机械地把 printf 函数的格式代码照搬于 scanf 函数
- 在应该使用 && 操作符的地方误用了 & 操作符
- 误用 = 操作符而不是 == 操作符来测试相等性

### 提示

- 使用 #include 指令避免重复声明
- 使用 #define 指令给常量值取名
- 在 #include 文件中放置函数原型
- 在使用下标前先检查它们的值
- 在 while 或 if 表达式中蕴含赋值操作
- 如何编写一个空循环体（使用;）
- 始终要进行检查，确保数组不越界（编译器不会报错，建议使用小工具 cppcheck）

## 基本概念

### 警告

- 字符串常量中的字符被错误的解释为三字母词
- 编写的糟糕的注释可能会意外地中止语句
- 注释的不适当结束

### 提示

**良好的风格和文档将使程序更容易阅读与维护**

## 数据

### 警告

- 在声明指针变量时采用容易误导的写法
- 误解指针声明中初始化的含义

### 提示

- 为了保持最佳的可移植性，把字符的值限制在有符号和无符号字符范围的交集之内，或者不要在字符上执行算术运算
- 用它们在使用时最自然的形式来表示字面值
- 不要把整形值和枚举值混在一起使用
- 不要依赖隐式声明
- 在定义类型的新名字时，使用 typedef 而不是 #define
- 用 const 声明其值不会修改的变量
- 使用名字常量而不是字面值常量
- 不要在嵌套的代码块之间使用相同的变量名
- 除了实体的具体定义之外，在它的其他声明位置都使用 extern 关键字

## 语句

### 警告

- 编写不会产生任何结果的表达式
- 确信在 if 语句中的语句列表前后加上花括号
- 在 switch 语句中，执行流意外地从一个 case 顺延到下一个 case

### 提示

- 在一个没有循环体的循环中，用一个分号表示空语句，并让它独占一行
- for 循环的可读性比 while 循环强，因为它把用于控制循环的表达式收集起来放在一个地方
- 在每个 switch 语句中都使用 default 子句

## 操作符和表达式

### 警告

- 有符号值的右移位操作是不可移植的
- 移位操作的位数是个负值
- 连续赋值中各个变量的长度不一
- 误用 = 而不是 == 进行比较
- 误用 | 而不是 ||，误用 & 而不是 &&
- 在不同的用于表示布尔值的非零值之间进行比较
- 表达式赋值的位置并不决定表达式计算的精度
- 编写结果依赖于求值顺序的表达式

### 提示

- 使用复合赋值符可以使程序更易于维护
- 使用条件操作符替代 if 语句可以简化表达式
- 使用逗号操作符k来消除多余的代码
- 不要混用整形和布尔型值

## 指针

### 警告
- 错误地对一个未初始化的指针变量进行解引用
- 错误地对一个 NULL 指针进行解引用
- 向函数传递错误地传递 NULL 指针
- 未检测指针表达式的错误，从而导致不可预料的结果
- 对一个指针进行减法运算，使它非法地指向了数组第 1 个元素的前面的内存位置

### 提示
- 一个值应该只具有一种意思
- 如果指针并不指向任何有意义的东西，就把它设置为 NULL

## 函数

### 警告
- 错误地在其他函数的作用域内编写函数原型
- 没有为那些返回值不是整形的函数编写原型
- 把函数原型和旧式风格的函数定义混合使用
- 在 va_arg 中使用错误的参数类型，导致未定义的结果

### 提示
- 在函数原型中使用参数名，可以给使用该函数的用户提供更多的信息
- 抽象数据类型可以减少抽象对模块实现细节的依赖，从而提高程序的可靠性
- 当递归定义清晰的优点可以补偿它的效率开销时，就可以使用这个工具

## 数组

### 警告
- 当访问多维数组的元素时，误用逗号分隔下标
- 在一个指向未指定长度的数组的指针上执行指针运算

### 提示
- 一开始就编写良好的代码显然比依赖编译器来修正劣质代码更好
- 源代码的可读性几乎总比程序运行时效率更为重要
- 只要有可能，函数的指针形参都应该声明为 const
- 在有些环境中，使用 register 关键字提高程序的x运行时效率
- 在多维数组的初始值列表中使用完整的多层花括号能提高可读性

## 字符串、字符和字节

### 警告
- 应该使用有符号数的表达式中 strlen 函数
- 在表达式中混有有符号数和无符号数
- 使用 strcat 函数把一个长字符串复制到一个较短的数组中，导致溢出
- 把 strcmp 函数的返回值当作布尔值进行测试
- 把 strcmp 函数的返回值与 1 和 -1 进行比较
- 使用并非以 NUL 字符结尾的字符序列
- 使用 strcpy 函数产生不以 NUL 字符结尾的字符串
- 把 strcpy 函数和 strxxx 族函数混用
- 忘了 strtok 函数会修改它所处理的字符串
- strtok 函数是不可再入的

### 提示
- 不要试图自己编写功能相同的函数来取代库函数
- 使用字符分类和转换函数可以提高函数的移植性

## 结构和联合

### 警告
- 具有相同成员列表的结构声明产生不同类型的变量
- 使用 typedef 为一个自引用的结构定义名字时应该小心
- 向函数传递结构参数是低效的

### 提示
- 把结构标签声明和结构的 typedef 声明放在头文件中，当源文件需要这些声明时可以通过 #include 指令把它们包含进来
- 结构成员的最佳排列形式并不一定就是考虑边界对齐而浪费内存空间最少的那种排列形式
- 把位段成员显示地声明为 signed int 或 unsigned int 类型
- 位段是不可移植的
- 位段使源代码中位的操作表达得更为清楚

## 动态内存分配

### 警告
- 不检查从 malloc 函数返回的指针是否为 NULL
- 访问动态分配的内存之外的区域
- 向 free 函数传递一个并非由 malloc 函数返回的指针
- 在动态内存被释放后再访问它

### 提示
- 动态内存分配有助于消除程序内部存在的限制
- 使用 sizeof 计算数据类型的长度，提高程序的可移植性

## 使用结构和指针

### 警告
- 落到链表尾部的后面
- 使用指针时应格外小心，因为 C 并没有对它们的使用提供安全网
- 从 if 语句中提炼语句可能会改变测试结果

### 提示
- 消除特殊情况使代码更易于维护
- 通过提炼语句消除 if 语句中的重复语句
- 不要仅仅根据代码大小评估它的质量

## 高级指针话题

### 警告 
- 对一个未初始化的指针执行间接访问操作
- 在转移表中使用越界下标

### 提示
- 如果并非必要，避免使用多层间接访问
- 把 ``` void * ``` 强制转换为其他类型的指针时必须小心
- 使用转移表时，应该始终验证下标的有效性
- 破坏性的命令行参数处理方式使你以后无法再次进行处理
- 不寻常的代码始终应该加上一条注释，描述它的目的和原理

##预处理器

### 警告
- 不要在宏定义的末尾加上分号
- 在宏定义中使用参数，但忘了在它们周围加上括号
- 忘了在整个宏定义的两边加上括号

### 提示
- 避免用 #define 指令定义可以用函数实现的很长序列的代码
- 在那些对表达式求值的宏中，每个宏参数出现的地方都应该加上括号，并且整个宏定义的两边也加上括号
- 避免用 #define 宏创建一种新语言
- 采用命名约定，是程序员很容易看出来某个标识符是否为 #define 宏
- 只要合适就应该使用文件包含，不必担心它的额外开销
- 头文件只应该包含一组函数和数据的声明
- 把不同集合的声明分离到不同的头文件中可以改善信息隐藏
- 嵌套的 #include 使我们很难判断源文件之间的依赖关系

## 输入输出函数

### 警告
- 忘了在一条调试用的 printf 函数后面跟一个 fflush 调用
- 不检查 fopen 函数的返回值
- 改变文件的位置将丢弃任何被退回到流的字符
- 在使用 fgets 时指定太小的缓冲区
- 使用 gets 的输入溢出缓冲区且未被检测到
- 使用任何 scanf 系列函数时，格式代码和参数指针类型不匹配
- 在任何 scanf 系列函数的每个非数组、非指针参数前忘了加上& 符号
- 注意在使用 scanf 系列函数转换 double、long double、short 和 long 整型时，在格式代码加上合适的限定符
- sprinf 函数的输出溢出了缓冲区且未检测到
- 混淆 printf 和 scanf 格式代码
- 使用任何 printf 系列函数时，格式代码和参数类型不匹配
- 在有些长整数长于普通整数的机器上打印长整数时，忘了在格式代码中指定 l 修改符
- 使用自动数组作为流的缓冲区时应多加小心

### 提示
- 在可能出现错误的场合，检查并报告错误
- 操纵文本行而无需估计它们的外部表示形式这个能力有助于提高程序的移植性
- 使用 scanf 限定符提高可移植性
- 当打印长整数时，即使当前机器并不需要，坚持使用 l 修改符可以提高移植性

## 标准函数库

### 警告
- 忘了包含 math.h 头文件可能导致数学函数产生不正确的结果
- clock 函数可能只产生处理器时间的近似值
- time 函数的返回值并不一定是以秒为单位的
- tm 结构中的月份的范围并不是 1 到 12
- tm 结构中的年是从 1900 年开始计数的年数
- longjmp 不能返回到一个已经不再处于活动状态的函数
- 从异步信号的处理函数中调用 exit 或 abort 函数是不安全的
- 当每次信号发生时，必须重新设置信号处理函数
- 避免 exit 函数的多重调用

### 提示
- 滥用 setjmp 和 longjmp
- 对信号进行处理将导致程序的可移植性变差
- 使用断言可以简化程序的调试
